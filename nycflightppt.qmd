---
title: "New York Flight Data Analysis"
title-slide-attributes:
    data-background-image: ./static/images/airport.gif
    data-background-size: cover
    data-background-opacity: "0.8"
subtitle: "sub title"
author: "TEAM EE"
format: 
    revealjs:
        logo: ./static/images/lsstats-removebg.png
        theme: default
        reference-location: document
        footer: "LS Big Data School EE"
        css: ./static/css/statple.css

--- 


# about TEAM

ë°•ìˆ˜í˜„ ì´ì£¼í˜• ì˜¤ìœ¤ì§€ ì¡°ìµí˜„

# NYC flights data ë¥¼ ì•Œì•„ë³´ì!



## nycflights13 - flights, planes
:::: {.columns}

::: {.column width="50%"}
`flights.info()`
```{python}
import numpy as np
import pandas as pd 
from nycflights13 import flights, planes
import matplotlib.pyplot as plt
flights.info()
```

:::

::: {.column width="50%"}
`planes.info()`
```{python}
planes.info()
```

:::


::::


## ìš°ë¦¬ì˜ ì£¼ì œ
#### flights(airtime) ì¹¼ëŸ¼ê³¼ planes(seats) ì¹¼ëŸ¼ì€ ë¬´ìŠ¨ ê´€ê³„ì¼ê¹Œ?
#### delay(arr_delay, dep_delay)ëŠ” ì–´ë–¨ ë•Œ ë§ì´ ìƒê¸¸ê¹Œ?
##### ë¹„í–‰ê¸° ì œì¡°ë…„ë„ ë³„ ì§€ì—°ì‹œê°„ í™•ì¸.
##### month ì™€ delay í™•ì¸.


## ë°ì´í„° í™•ì¸ {.scrollable}
### ì§€ì—°ì‹œê°„ì— ì´ìƒì¹˜ê°€ ìˆë‹¤!
:::: {.columns}

::: {.column width="50%"}
```{python}
## 'dep_delay' íˆìŠ¤í† ê·¸ë¨
plt.figure(figsize=(6,4))       
plt.hist(flights['dep_delay'], 
         bins=20, 
         edgecolor='black', 
         alpha=0.7) 
plt.xlabel("dep_delay")
plt.ylabel("Frequency")
plt.show()


## 'arr_delay' íˆìŠ¤í† ê·¸ë¨
plt.figure(figsize=(6,4))       
plt.hist(flights['arr_delay'], 
         bins=20, 
         edgecolor='black', 
         alpha=0.7) 
plt.xlabel("arr_delay")
plt.ylabel("Frequency")
plt.show()

```

:::

::: {.column width="50%"}



<br>

| Statistic | Value         |
|-----------|-------------- |
| count     | 327346.000000 |
| mean      | 6.895377      |
| std       | 44.633292     |
| min       | -86.000000    |
| 25%       | -17.000000    |
| 50%       | -5.000000     |
| 75%       | 14.000000     |
| max       | 1272.000000   |
| Name: arr_delay |
:::


::::

## ì „ì²˜ë¦¬

planesì™€ flights ë°ì´í„°ë¥¼ left join 
```{python}
# ìµœì¢… ì „ì²˜ë¦¬ ì‹œì‘.

flights_df = flights.copy()
planes_df = planes.copy()


# ì „ì²˜ë¦¬ í•¨ìˆ˜
def PreProcessing(df, columns):
    """
    ì—¬ëŸ¬ ê°œì˜ ì»¬ëŸ¼ì— ëŒ€í•´ IQR ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ ì´ìƒì¹˜ë¥¼ ì œê±°í•˜ëŠ” í•¨ìˆ˜

    Parameters:
    df (pd.DataFrame): ë°ì´í„°í”„ë ˆì„
    columns (list): ì´ìƒì¹˜ë¥¼ ì œê±°í•  ì»¬ëŸ¼ ë¦¬ìŠ¤íŠ¸

    Returns:
    pd.DataFrame: ì´ìƒì¹˜ê°€ ì œê±°ëœ ë°ì´í„°í”„ë ˆì„
    """
    f_df = df.copy()  # ì›ë³¸ ë°ì´í„°í”„ë ˆì„ ìœ ì§€

    for column in columns:
        desc = f_df[column].describe()
        q1 = desc["25%"]
        q3 = desc["75%"]
        iqr = q3 - q1
        lower_boundary = q1 - (iqr * 1.5)
        upper_boundary = q3 + (iqr * 1.5)

        # ì´ìƒì¹˜ ì œê±° ì ìš©
        f_df = f_df[(f_df[column] >= lower_boundary) & (f_df[column] <= upper_boundary)]

    return f_df


# í•„ìš” ì—†ëŠ” ì¹¼ëŸ¼ ì œê±°
flights_df = flights_df.drop(columns=["year"])
planes_df = planes_df.drop(columns=["speed"])

# ê²°ì¸¡ì¹˜ ì²˜ë¦¬
flights_df.isna().sum()
planes_df.isna().sum()

flights_df = flights_df.dropna(
    subset=["dep_time", "dep_delay", "arr_time", "arr_delay", "tailnum", "air_time"]
)
planes_df = planes_df.dropna()


# merge: planes_dfì™€ flights_dfë¥¼ tailnumìœ¼ë¡œ left join
merged_df = pd.merge(planes_df, flights_df, on="tailnum", how="left")


# ì§€ì—°ì‹œê°„ì— ëŒ€í•´ ì „ì²˜ë¦¬ í•¨ìˆ˜ ì ìš©
merged_df_f = PreProcessing(merged_df, ["arr_delay", "dep_delay"])


# íŒŒìƒ ë³€ìˆ˜ ìƒì„±

## delay í•©.
merged_df_f["delay"] = merged_df_f["arr_delay"] + merged_df_f["dep_delay"]


```

## ì „ì²˜ë¦¬ í›„ ì§€ì—°ì‹œê°„(delay) íˆìŠ¤í† ê·¸ë¨ {.scrollable}

```{python}
## 'dep_delay' íˆìŠ¤í† ê·¸ë¨
plt.figure(figsize=(6,4))       
plt.hist(merged_df_f['dep_delay'], 
         bins=20, 
         edgecolor='black', 
         alpha=0.7) 
plt.xlabel("dep_delay")
plt.ylabel("Frequency")
plt.show()


## 'arr_delay' íˆìŠ¤í† ê·¸ë¨
plt.figure(figsize=(6,4))       
plt.hist(merged_df_f['arr_delay'], 
         bins=20, 
         edgecolor='black', 
         alpha=0.7) 
plt.xlabel("arr_delay")
plt.ylabel("Frequency")
plt.show()

## 'delay' íˆìŠ¤í† ê·¸ë¨
plt.figure(figsize=(6,4))       
plt.hist(merged_df_f['delay'], 
         bins=20, 
         edgecolor='black', 
         alpha=0.7) 
plt.xlabel("delay")
plt.ylabel("Frequency")
plt.show()


```



## month, day, hour ë³€ìˆ˜ì™€ delay ê°„ ì‹œê°í™” {.scrollable}

```{python}
import seaborn as sns

# (df, ê·¸ë£¹í™”í•  ì¹¼ëŸ¼ ë¦¬ìŠ¤íŠ¸, íƒ€ê²Ÿ ì¹¼ëŸ¼ ë¬¸ìì—´)
def visualization_df(df, group_cols, target):
    for col in group_cols:
        # grouped_df = df.groupby(cat_col)['delay'].mean()  # ê·¸ë£¹ë³„ í‰ê·  ê³„ì‚°

        # ì‹œê°í™”
        plt.figure(figsize=(9, 5))
        
        sns.barplot(x=col, y=target, data=df, estimator=np.mean,
                     palette="viridis", edgecolor="black")
        plt.xlabel(col)
        plt.ylabel(f"Average ")
        plt.title(f"Average by {col}")
        plt.xticks(rotation=90)
        plt.grid(axis="y", linestyle="--", alpha=0.7)
        plt.show()
```

```{python}
#| echo: false

# ì›”, ì¼, ì‹œê°„ ë³€ìˆ˜ ì™€ delay Visualization
time_cols = ['month', 'day', 'hour']

visualization_df(merged_df_f, time_cols, 'delay' )
```

## ë‚˜ë¨¸ì§€ ë²”ì£¼í˜• ë³€ìˆ˜ì™€ delay ê°„ ì‹œê°í™” {.scrollable}

```{python}
#| echo: false

# ìˆ«ì ì•„ë‹Œ ë‹¤ë¥¸ ì¹¼ëŸ¼ê³¼ delay Visualization
# ìˆ«ìê°€ ì•„ë‹Œ ì¹¼ëŸ¼(ë²”ì£¼í˜•)
categorical_cols = merged_df_f.select_dtypes(exclude='number').columns 
categorical_cols = categorical_cols.delete([0,-1])

# visualization_df(merged_df_f, categorical_cols, 'delay' )
```


## í”„ë¦°íŠ¸ í•¨ìˆ˜

```{python}
def print_grouped_data(df, group_cols, target):
    """
    íŠ¹ì •í•œ ë²”ì£¼í˜• ì»¬ëŸ¼ ë¦¬ìŠ¤íŠ¸(group_cols)ì— ëŒ€í•´ ìˆ«ìí˜• ì¹¼ëŸ¼(num_col)ì˜ groupby í†µê³„ë¥¼ ì¶œë ¥í•˜ëŠ” í•¨ìˆ˜.
    """
    for cat_col in group_cols:
        if cat_col not in df.columns:
            print(f"âš ï¸ Warning: '{cat_col}' ì¹¼ëŸ¼ì´ ë°ì´í„°í”„ë ˆì„ì— ì—†ìŒ\n")
            continue  # ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì»¬ëŸ¼ì´ë©´ ê±´ë„ˆë›°ê¸°
        
        grouped = df.groupby(cat_col)[target].agg(['mean', 'median', 'count', 'std'])
        print(f"\nğŸ“Œ Grouped statistics by '{cat_col}':\n")
        print(grouped)
        print("-" * 50)
```

```{python}
print_grouped_data(merged_df_f, time_cols, 'delay')

```


## ì „ì²´ íˆíŠ¸ë§µ

```{python}
import seaborn as sns
corr_mat = merged_df.select_dtypes('number').corr()
plt.figure(figsize=(10,10))
sns.heatmap(corr_mat, annot=True,
            cmap="coolwarm", fmt=".2f", linewidths=0.5)
plt.title("Heatmap of Feature Correlations")
plt.show()
```


# flights(air_time) ì¹¼ëŸ¼ê³¼ planes(seats) ì¹¼ëŸ¼ì€ ë¬´ìŠ¨ ê´€ê³„ì¼ê¹Œ?

## ë¹„í–‰ì‹œê°„ê³¼ ì¢Œì„ìˆ˜ ìƒê´€ê³„ìˆ˜ì˜ ê´€ê³„

### flights(air_time)-planes(seats)
- +0.54ì˜ ìƒê´€ê³„ìˆ˜ë¥¼ ê°–ëŠ”ë‹¤. => ë¹„êµì  ê°•í•œ ìƒê´€ê³„ìˆ˜ë¥¼ ê°€ì§„ë‹¤.
- **seat(ì¢Œì„ìˆ˜)**ê°€ ë§ì€ìˆ˜ë¡ **ë¹„í–‰ì‹œê°„**ì´ ê¸¸ë‹¤.
- í° ë¹„í–‰ê¸° ì¼ ìˆ˜ë¡ ë¹„í–‰ ì‹œê°„ì´ ê¸¸ë‹¤.

### flights(air_time)-flights(distance)
- +0.52ì˜ ìƒê´€ê³„ìˆ˜ë¥¼ ê°–ëŠ”ë‹¤. => ë¹„êµì  ê°•í•œ ìƒê´€ê³„ìˆ˜ë¥¼ ê°€ì§„ë‹¤.
- **seat(ì¢Œì„ìˆ˜)**ê°€ ë§ì„ìˆ˜ë¡ **ëª©ì ì§€**ê¹Œì§€ì˜ ê±°ë¦¬ê°€ ê¸¸ë‹¤.
- í° ë¹„í–‰ê¸°ì¼ìˆ˜ë¡ ëª©ì ì§€ê¹Œì§€ì˜ ê±°ë¦¬ê°€ ê¸¸ë‹¤.

## air_timeê³¼ seats/distance ìƒê´€ê´€ê³„ ì‹œê°í™”


## air_time-seatsì˜ ê´€ê³„
ë¹„í–‰ì‹œê°„(air_time)ê³¼ ì¢Œì„ ìˆ˜(seats)ì˜ ê´€ê³„ ì‹œê°í™” ì½”ë“œ
```{python}
plt.figure(figsize=(10, 10))
sns.scatterplot(
    x=merged_df["air_time"],
    y=merged_df["seats"],
    hue=merged_df["model"],
    sizes=(30, 200),
    palette="Set2",
    alpha=0.5,
    data=merged_df,
)

sns.regplot(
    x=merged_df["air_time"],
    y=merged_df["seats"],
    scatter=False,
    color="red",
)

plt.xlabel("air_time")
plt.ylabel("seats")
plt.title("Scatter Plot")
plt.show()
```

- seats ë³€ìˆ˜ëŠ” ëŒ€ë¶€ë¶„ 100~200 ì‚¬ì´ì— ì§‘ì¤‘
- ëŒ€ë¶€ë¶„ì˜ í•­ê³µê¸°ê°€ ì¤‘í˜• í¬ê¸°ë¡œ ì„¤ê³„ë˜ì—ˆìŒ
- ì¢Œì„ ìˆ˜ê°€ ë§ì„ìˆ˜ë¡ ë¹„í–‰ ì‹œê°„ì´ ê¸¸ì–´ì§€ëŠ” ê²½í–¥ì´ ê´€ì°°ë¨
- ì†ë„ê°€ ë†’ì€ í•­ê³µê¸°ëŠ” ë¹„í–‰ ì‹œê°„ì´ ì§§ê±°ë‚˜ íŠ¹ì • ì¢Œì„ ìˆ˜ì— ì§‘ì¤‘ë˜ì–´ ìˆìŒ
- seatsì™€ air_time: ìƒê´€ê³„ìˆ˜ +0.52ë¡œ, ì¢Œì„ ìˆ˜ê°€ ë§ì„ìˆ˜ë¡ ë¹„í–‰ ì‹œê°„ì´ ê¸¸ì–´ì§€ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤.


## flights(distance)-flights(seats)ì˜ ê´€ê³„
ë¹„í–‰ê±°ë¦¬ì™€ ì¢Œì„ ìˆ˜ì˜ ê´€ê³„ ì‹œê°í™” ì½”ë“œ
```{python}
import seaborn as sns

plt.figure(figsize=(10, 10))
sns.scatterplot(
    x=merged_df["distance"],
    y=merged_df["seats"],
    sizes=(30, 200),
    palette="Set2",
    alpha=0.5,
    data=merged_df,
)

# Regression line (correlation line)
sns.regplot(
    x=merged_df["air_time"],
    y=merged_df["seats"],
    scatter=False,
    color="orange",
)

plt.xlabel("air_time")
plt.ylabel("seats")
plt.title("Scatter Plot")
plt.show()
```


## ë‘˜ ì‚¬ì´ì˜ ê´€ê³„
- ë¹„í–‰ê¸°ì˜ êµ¬ì¡°ì ì¸ ì¸¡ë©´
ë©€ë¦¬ ê°€ë ¤ë©´ ì—°ë£Œê°€ ë§ì´ í•„ìš”í•˜ë‹¤. ì—°ë£Œí†µì´ í° ë¹„í–‰ê¸°ê°€ í•„ìš”í•˜ë‹¤. í° ë¹„í–‰ê¸°ëŠ” ì¢Œì„ìˆ˜ê°€ ë§ë‹¤.

- ê·œëª¨ì˜ ê²½ì œ ì¸¡ë©´
ê°™ì€ ëˆì„ ë‚´ë”ë¼ë„ ì‚¬ëŒ ìˆ˜ê°€ ë§ìœ¼ë©´ ë©€ë¦¬ê°ˆ ìˆ˜ ìˆë‹¤. 



# ì§€ì—°ì‹œê°„(delay)ê³¼ ê´€ê³„ê°€ ìˆëŠ” ì¹¼ëŸ¼ì€ ë¬´ì—‡ì¸ê°€?

## ë¹„í–‰ê¸° ì œì¡°ë…„ë„ì™€ ì§€ì—°ì‹œê°„ ê´€ê³„ 

```{python}

```

## ë‚ ì”¨ì™€ ì§€ì—°ì‹œê°„ ê´€ê³„

```{python}

```



# ìµœì¢… ê²°ë¡ 

## Conclusion

- airtimeì´ ê¸¸ì–´ì§ˆ ìˆ˜ë¡ ì‹œíŠ¸ ìˆ˜ê°€ ë§ë‹¤. ì¦‰ ì´ë™í•œë‹¤.

